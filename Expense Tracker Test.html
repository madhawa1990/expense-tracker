<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>

<title>Expense Tracker</title>

<style>
body{
  font-family: system-ui;
  padding:10px;
  max-width:400px;
  margin:auto;
  background-color: #f8f9fa;
}
input, select, button{
  width:100%;
  padding:12px;
  margin:8px 0;
  font-size:16px;
}
button{
  background:#000;
  color:white;
  border:none;
}
label {
    color: #7a7978;
}
</style>
</head>

<body>

<!-- <h2>Add Expense</h2> -->

<!-- <input id="mdate" placeholder="Date" type="date">
<select id="category"></select>
<input id="desc" placeholder="Description">
<input id="amount" type="number" placeholder="Amount">
<button onclick="save()">Save Expense</button> -->

<div class="container mt-5">
  <h2 class="mb-4 text-center">Add Expense</h2>
  <div id="message"></div> <!-- Success/Error messages -->
  <div class="row">
    <div class="col">
      <form id="expenseForm" class="needs-validation" novalidate>
          <!-- Date -->
          <div class="mb-3">
            <label for="expenseDate" class="form-label mb-0">Date</label>
            <input type="date" class="form-control mt-0 mb-0 form-control-lg" id="mdate" name="mdate" required>
            <div class="invalid-feedback">Please select a date.</div>
          </div>

          <!-- Category -->
          <div class="mb-3">
            <label for="category" class="form-label mb-0">Category</label>
            <select class="form-select mt-0 mb-0 form-control-lg" id="category" name="category" required>
              <option value="">Select category</option>
            </select>
            <div class="invalid-feedback">Please select a category.</div>
          </div>

          <!-- Description -->
          <div class="mb-3">
            <label for="description" class="form-label mb-0">Description</label>
            <input type="text" class="form-control mt-0 mb-0 form-control-lg" id="desc" name="desc" placeholder="Enter description" required>
            <div class="invalid-feedback">Please enter a description.</div>
          </div>

          <!-- Amount -->
          <div class="mb-3">
            <label for="amount" class="form-label mb-0">Amount</label>
            <input type="number" class="form-control mt-0 mb-0 form-control-lg" id="amount" name="amount" placeholder="0.00" min="0" step="0.01" required>
            <div class="invalid-feedback">Please enter a valid amount.</div>
          </div>

          <!-- Save Button -->
          <button type="submit" class="btn btn-primary form-control-lg" id="saveBtn">
            <span id="loadingSpinner" class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
            Save
          </button>
        </form>
    </div>
  </div>
</div>


<script>

const URL = "https://script.google.com/macros/s/AKfycbyJ6H9okpMw2pMk9KYM-RYTT3Gzl4KyV8DfCaSYtT0MxX2bOte_2orSsg8zserJUFIQpw/exec";

// Load categories
async function loadCategories(){
  const res = await fetch(URL);
  const data = await res.json();
  const select = document.getElementById("category");

  data.forEach(c=>{
    const opt = document.createElement("option");
    opt.value = c;
    opt.text = c;
    select.appendChild(opt);
  });
}

const form = document.getElementById('expenseForm');
const spinner = document.getElementById('loadingSpinner');
//const messageDiv = document.getElementById('message');

 form.addEventListener('submit', async function(event) {
  event.preventDefault(); // Prevent page refresh
  event.stopPropagation();

  const category = document.getElementById("category").value;
  const description = document.getElementById("desc").value;
  const amount = document.getElementById("amount").value;
  const mdate = document.getElementById("mdate").value;

  if (!form.checkValidity()) {
    form.classList.add('was-validated');
    return;
  }

  spinner.classList.remove('d-none');
  saveBtn.setAttribute('disabled', true);
  //messageDiv.innerHTML = '';

    await fetch(URL,{
    method:"POST",
    body: JSON.stringify({
      category,
      description,
      amount
    })
  });
    desc.value="";
    amount.value="";
    spinner.classList.add('d-none');
    saveBtn.removeAttribute('disabled');
    form.reset();
    document.getElementById('mdate').value = today; // Reset date to today
    form.classList.remove('was-validated');

});

  const today = new Date().toISOString().split('T')[0];
  document.getElementById('mdate').value = today;

loadCategories();

</script>
</body>
</html>